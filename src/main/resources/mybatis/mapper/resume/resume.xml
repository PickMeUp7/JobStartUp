<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="resume">

    <!-- 이력서 목록 조회 -->
    <select id="selectResumeList" resultType="ResumeDTO"><!-- resultType에 있는 ResumeDTO가 mybatis-config.xml에 alias로 명시해준 것 -->
        <![CDATA[
        SELECT *
        FROM RESUME
        ORDER BY RESUME_NO DESC
        ]]>
    </select>

    <!-- 이력서 상세 조회 -->
    <select id="selectResumeDetail" resultType="ResumeDTO" parameterType="int">
        <![CDATA[
        SELECT *
        FROM RESUME
        WHERE RESUME_NO=#{resume_no}
        ]]>
    </select>

    <!-- 이력서 삭제 -->
    <delete id="deleteResume" parameterType="int">
        <![CDATA[
        DELETE RESUME
        WHERE RESUME_NO=#{resume_no}
        ]]>
    </delete>

    <!-- 이력서 등록 -->
    <!--<insert id="insertResume" parameterType="ResumeDTO">
        <![CDATA[
        INSERT INTO RESUME (MEMBER_NO, RESUME_TITLE, PROFILE_ORGNAME, PROFILE_SAVNAME, RESUME_MONEY, RESUME_SKILL, RESUME_ORGNAME, RESUME_SAVNAME, RESUME_URL)
        VALUES (#{member_no}, #{resume_title}, #{profile_orgname}, #{profile_savname}, #{resume_money}, #{resume_skill}, #{resume_orgname}, #{resume_savname}, #{resume_url})
        ]]>
    </insert>-->

    <!-- 이력서 등록 -->
    <insert id="insertResume" parameterType="com.pickmeup.jobstartup.resume.dto.ResumeParameter" useGeneratedKeys="true" keyProperty="resume_no">
        <!-- LANGUAGE_SEQ에서 LANG_NO 가져오기 -->
        <selectKey keyProperty="item.lang_no" resultType="int" order="BEFORE">
            SELECT NEXTVAL FOR LANGUAGE_SEQ AS lang_no FROM DUAL
        </selectKey>
        <foreach collection="list" item="item" separator=";">

            INSERT INTO RESUME (MEMBER_NO, RESUME_TITLE, PROFILE_ORGNAME, PROFILE_SAVNAME, RESUME_MONEY, RESUME_SKILL, RESUME_ORGNAME, RESUME_SAVNAME, RESUME_URL)
            VALUES (#{item.member_no}, #{item.resume_title}, #{item.profile_orgname}, #{item.profile_savname}, #{item.resume_money}, #{item.resume_skill}, #{item.resume_orgname}, #{item.resume_savname}, #{item.resume_url});

            INSERT INTO RESUME_LOC (RESUME_NO, LOC_DETAIL_CODE_NUM)
            VALUES (#{item.resume_no}, #{item.loc_detail_code_num});

            INSERT INTO CAREER (RESUME_NO, CAREER_DATE, CAREER_COMPANY, BUSINESS_TYPE, CAREER_WORK)
            VALUES (#{item.resume_no}, #{item.career_date}, #{item.career_company}, #{item.business_type}, #{item.career_work});

            INSERT INTO CERTIFICATE (RESUME_NO, CER_NAME, CER_ISSUER, CER_DATE)
            VALUES (#{item.resume_no}, #{item.cer_name}, #{item.cer_issuer}, #{item.cer_date});

            INSERT INTO LANGUAGE (RESUME_NO, LANG_NAME, LANG_LEVEL, LANG_NO)
            VALUES (#{item.resume_no}, #{item.lang_name}, #{item.lang_level}, #{item.lang_no});

            INSERT INTO LANGUAGE_CERTIFICATE (LANG_NO, LANG_CER_EXAM, LANG_CER_GRADE, LANG_CER_DATE)
            VALUES (#{item.lang_no}, #{item.lang_cer_exam}, #{item.lang_cer_grade}, #{item.lang_cer_date});
        </foreach>
    </insert>
</mapper>