<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pickmeup.jobstartup.recruiter.jobposting.repository.JobPostingRepository">

    <!--채용공고 등록-->
    <insert id="insertJobPostingDTO" parameterType="JobPostingDTO">
        <![CDATA[
        INSERT INTO JOB_POSTING (COMPANY_NO, POSTING_TITLE, POSTING_CAREER, POSTING_ACADEMY, POSTING_LABOR,
                                 POSTING_SALARY, POSTING_SDATE, POSTING_EDATE, POSTING_CONTENT, POSTING_CNT,
                                 POSTING_WORKING_DAY, POSTING_SWORK, POSTING_EWORK)
        VALUES (#{company_no}, #{posting_title}, #{posting_career}, #{posting_academy}, #{posting_labor},
                #{posting_salary}, #{posting_sdate}, #{posting_edate}, #{posting_content}, #{posting_cnt},
                #{posting_working_day}, #{posting_swork}, #{posting_ework})
        ]]>
    </insert>

    <!--채용공고 목록조회-->
    <select id="selectJPlist" parameterType="int" resultType="JobPostingDTO">
        <![CDATA[
        SELECT J.POSTING_NO,
               J.POSTING_TITLE,
               J.POSTING_CAREER,
               J.POSTING_ACADEMY,
               J.POSTING_LABOR,
               J.POSTING_SALARY,
               C.COMPANY_NAME,
               C.COMPANY_ADDRESS_DETAIL
        FROM JOB_POSTING J,
             COMPANY C
        WHERE J.COMPANY_NO = C.COMPANY_NO
        AND TRUNC(J.POSTING_SDATE) <= TRUNC(SYSDATE) AND TRUNC(SYSDATE) <= TRUNC(J.POSTING_EDATE)
        ORDER BY POSTING_NO DESC
        ]]>
    </select>


    <!--공고상세조회-->
    <select id="selectJPdetail" parameterType="int" resultType="JobPostingDTO">
    <![CDATA[
        SELECT J.POSTING_NO,
               J.POSTING_TITLE,
               J.POSTING_CAREER,
               J.POSTING_ACADEMY,
               J.POSTING_LABOR,
               J.POSTING_SALARY,
               J.POSTING_WORKING_DAY,
               J.POSTING_CONTENT,
               J.POSTING_SWORK,
               J.POSTING_EWORK,
               C.COMPANY_NAME,
               C.COMPANY_ADDRESS_DETAIL,
               C.COMPANY_NO
        FROM COMPANY C
                 INNER JOIN JOB_POSTING J ON C.COMPANY_NO = J.COMPANY_NO
        WHERE J.POSTING_NO = #{posting_no}
        ]]>
    </select>

    <!--게시글수정-->
    <update id="JPmodify" parameterType="map">
        <![CDATA[
        UPDATE JOB_POSTING
        SET posting_title = #{posting_title},
            posting_career = #{posting_career},
            posting_academy = #{posting_academy},
            posting_labor = #{posting_labor},
            posting_salary = #{posting_salary},
            posting_working_day = #{posting_working_day},
            posting_content = #{posting_content}
        WHERE posting_no = #{posting_no}
        ]]>
    </update>
    
    <!--게시글삭제-->
    <delete id="JPdelete" parameterType="int">
        <![CDATA[
        DELETE FROM JOB_POSTING
        WHERE posting_no = #{posting_no}
        ]]>
    </delete>


    <!--상위주소-->
    <select id="getUpperLoc" resultType="com.pickmeup.jobstartup.recruiter.apply.dto.LocDTO">
        <![CDATA[
        SELECT *
        FROM detail_code
        WHERE detail_code_num >= 11000
          AND detail_code_num <= 39000
          and code_level = 1
        ORDER BY detail_code_num
        ]]>
    </select>

    <!--하위주소-->
    <select id="getLowerLoc" resultType="com.pickmeup.jobstartup.recruiter.apply.dto.LocDTO">
        <![CDATA[
        SELECT *
        FROM detail_code
        WHERE detail_code_num >= #{upperLoc} + 1
          AND detail_code_num < #{upperLoc} + 1000
          AND code_level = 2
        ORDER BY detail_code_num
        ]]>
    </select>


</mapper>